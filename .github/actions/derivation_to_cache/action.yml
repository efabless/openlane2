name: Derivation to Cache
description: Uploads the derivation generated by `default.nix` to the GitHub Actions Cache (not Cachix)
inputs:
  key:
    description: "The key to use for the cache entry"
    required: true
  file:
    description: "The file to use"
    required: true
    default: "default.nix"
  shell:
    description: "Shell to use"
    required: true
    default: "bash"
runs:
  using: "composite"
  steps:
    - name: Export Derivation
      shell: ${{ inputs.shell }}
      run: |
        nix --extra-experimental-features nix-command\
          copy\
          --to 'file:///tmp/${{ inputs.key }}?compression=zstd&parallel-compression=true'\
          $(nix-build ${{ inputs.file }})
    - name: Cache Derivation
      uses: actions/cache@v3
      with:
        key: ${{ inputs.key }}
        path: /tmp/${{ inputs.key }}
